# Exploiting Network-Based Vulnerabilities

## Windows Name Resolution and SMB Attacks (NetBIOS & SMB)

La résolution de nom est un aspect fondamental des réseaux, il existe plusieurs technologies et protocole de résolution d'addresse IPs. Nous pouvont citer :

- Network Basic Input/Output System (NetBIOS)
- Link-Local Multicast Name Resolution (LLMNR) (Port 5355 UDP)
- Domain Name System (DNS)

Nous allons découvrir les vulnérabilités et exploits concernant ces protocoles

### NetBIOS Name Service and LLMNR

Le NetBIOS et le LLMNR sont utilisés par windows pour l'identification des hôtes

- ```Le LLMNR``` est sous le format DNS et permet la résolution de nom entre hôtes dans le même LAN

- NetBIOS provides three different services:

    NetBIOS Name Service (NetBIOS-NS) for name registration and resolution
    Datagram Service (NetBIOS-DGM) for connectionless communication
    Session Service (NetBIOS-SSN) for connection-oriented communication

- NetBIOS-related operations use the following ports and protocols:

    - TCP port ```135```: Microsoft Remote Procedure Call (MS-RPC) endpoint mapper, used for client-to-client and server-to-client communication
    - UDP port ```137```: NetBIOS Name Service
    - UDP port ```138```: NetBIOS Datagram Service
    - TCP port ```139```: NetBIOS Session Service
    - TCP port ```445```: SMB protocol, used for sharing files between different operating systems, including Windows and Unix-based systems

#### Vulnérabilités de SMB, NetBIOS et LLMNR

- ```Non changement du group de travail par défaut qui est WORKGROUP``` :
    De nombreux utilisateurs laissent leur groupe de travail configuré avec ce nom par défaut et configurent le partage de fichiers ou d'imprimantes avec des informations d'identification faibles. Il est très facile pour un attaquant d'énumérer les machines et de compromettre le système en forçant les mots de passe ou en utilisant d'autres techniques.

- Usurpation de source LLMNR :
    Une vulnérabilité courante dans LLMNR implique qu'un attaquant usurpe une source faisant autorité pour la résolution de noms sur un système victime en répondant au trafic LLMNR sur le port UDP 5355 et au trafic NBT-NS sur le port UDP 137. L'attaquant empoisonne le service LLMNR pour manipuler le système de la victime. Si l'hôte demandé appartient à une ressource qui nécessite une identification ou une authentification, le nom d'utilisateur et le hachage NTLMv2 sont envoyés à l'attaquant. Ce dernier peut alors recueillir le hachage envoyé sur le réseau à l'aide d'outils tels que des renifleurs. Ensuite, l'attaquant peut forcer brutalement ou craquer les hachages hors ligne pour obtenir les mots de passe en clair.

#### Outils pour mener l'attaque

- NBNSpoof 
- Metasploit
- Responder
- Pupy :  Pupy est un outil d'administration à distance et de post-exploitation multiplateforme basé sur Python qui fonctionne sous Windows, Linux, macOS et même Android.

#### Mitigation

- Désactiver le LLMNR et le NetBIOS dans les paramètres de sécurité sur un ordinateur en local ou à travers une politique de groupes.
- One of the common detection techniques for LLMNR poisoning attacks is to monitor the registry key HKLMSoftwarePolicies MicrosoftWindows NTDNSClient for changes to the EnableMulticast DWORD value. If you see a zero (0) for the value of that key, you know that LLMNR is disabled.

## Exploit SMB

Le protocole SMB a eu à avoir plein de vulnérabilités. Nous pouvons les retrouver sur https://www.exploit-db.com/searchsploit/ en utilisant la commande ```searchsploit```

```bash
searchsploit smb 
```
L'exploit le plus utilisé est celui de EthernalBlue
